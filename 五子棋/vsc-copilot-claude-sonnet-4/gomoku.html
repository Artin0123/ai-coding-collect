<!DOCTYPE html>
<html lang="zh-TW">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>‰∫îÂ≠êÊ£ã - ‰∫∫Ê©üÂ∞çÊà∞</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background-color: #f0f0f0;
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
            }

            .game-container {
                background-color: white;
                border-radius: 10px;
                padding: 20px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                text-align: center;
            }

            h1 {
                color: #333;
                margin-bottom: 20px;
            }

            .game-info {
                margin-bottom: 20px;
                font-size: 18px;
                color: #666;
            }

            .status {
                font-weight: bold;
                color: #333;
                margin-bottom: 10px;
            }

            .board {
                display: inline-block;
                background-color: #D2B48C;
                border: 3px solid #8B4513;
                border-radius: 5px;
                padding: 10px;
            }

            .board-grid {
                display: grid;
                grid-template-columns: repeat(15, 30px);
                grid-template-rows: repeat(15, 30px);
                gap: 1px;
                background-color: #8B4513;
            }

            .cell {
                width: 30px;
                height: 30px;
                background-color: #D2B48C;
                border: none;
                cursor: pointer;
                position: relative;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                font-weight: bold;
            }

            .cell:hover:empty {
                background-color: #DEB887;
            }

            .cell.black {
                background-color: #333;
                color: white;
            }

            .cell.white {
                background-color: #f0f0f0;
                color: #333;
            }

            .cell::before {
                content: '';
                position: absolute;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                display: none;
            }

            .cell.black::before {
                background-color: #000;
                display: block;
            }

            .cell.white::before {
                background-color: #fff;
                border: 1px solid #333;
                display: block;
            }

            .controls {
                margin-top: 20px;
            }

            button {
                background-color: #4CAF50;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                margin: 0 10px;
            }

            button:hover {
                background-color: #45a049;
            }

            button:disabled {
                background-color: #cccccc;
                cursor: not-allowed;
            }

            .difficulty {
                margin: 10px 0;
            }

            select {
                padding: 5px 10px;
                border-radius: 5px;
                border: 1px solid #ddd;
                font-size: 16px;
            }

            .winner {
                color: #ff6b6b;
                font-weight: bold;
                font-size: 24px;
                margin: 20px 0;
            }
        </style>
    </head>

    <body>
        <div class="game-container">
            <h1>üî• ‰∫îÂ≠êÊ£ã - ‰∫∫Ê©üÂ∞çÊà∞</h1>

            <div class="game-info">
                <div class="status" id="status">Ëº™Âà∞ÊÇ®‰∏ãÊ£ã (ÈªëÂ≠ê)</div>
                <div class="difficulty">
                    <label for="difficultySelect">AIÈõ£Â∫¶Ôºö</label>
                    <select id="difficultySelect">
                        <option value="easy">Á∞°ÂñÆ</option>
                        <option value="medium" selected>‰∏≠Á≠â</option>
                        <option value="hard">Âõ∞Èõ£</option>
                    </select>
                </div>
            </div>

            <div class="board">
                <div class="board-grid" id="board"></div>
            </div>

            <div class="controls">
                <button onclick="startNewGame()">ÈáçÊñ∞ÈñãÂßã</button>
                <button onclick="undoMove()" id="undoBtn" disabled>ÊÇîÊ£ã</button>
            </div>

            <div id="winner" class="winner" style="display: none;"></div>
        </div>

        <script>
            const BOARD_SIZE = 15;
            let board = [];
            let currentPlayer = 'black'; // Áé©ÂÆ∂ÊòØÈªëÂ≠ê
            let gameOver = false;
            let moveHistory = [];

            // ÂàùÂßãÂåñÈÅäÊà≤
            function initGame() {
                board = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(null));
                currentPlayer = 'black';
                gameOver = false;
                moveHistory = [];
                updateStatus('Ëº™Âà∞ÊÇ®‰∏ãÊ£ã (ÈªëÂ≠ê)');
                document.getElementById('winner').style.display = 'none';
                document.getElementById('undoBtn').disabled = true;
                createBoard();
            }

            // ÂâµÂª∫Ê£ãÁõ§
            function createBoard() {
                const boardElement = document.getElementById('board');
                boardElement.innerHTML = '';

                for (let i = 0; i < BOARD_SIZE; i++) {
                    for (let j = 0; j < BOARD_SIZE; j++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.dataset.row = i;
                        cell.dataset.col = j;
                        cell.onclick = () => makeMove(i, j);
                        boardElement.appendChild(cell);
                    }
                }
            }

            // Êõ¥Êñ∞ÁãÄÊÖãÈ°ØÁ§∫
            function updateStatus(message) {
                document.getElementById('status').textContent = message;
            }

            // Áé©ÂÆ∂‰∏ãÊ£ã
            function makeMove(row, col) {
                if (gameOver || board[row][col] || currentPlayer !== 'black') {
                    return false;
                }

                // Ë®òÈåÑÁßªÂãï
                moveHistory.push({ row, col, player: currentPlayer });

                // ÊîæÁΩÆÊ£ãÂ≠ê
                board[row][col] = currentPlayer;
                updateBoard();

                // Ê™¢Êü•ÂãùÂà©
                if (checkWin(row, col, currentPlayer)) {
                    gameOver = true;
                    showWinner('ÊÅ≠ÂñúÔºÅÊÇ®Áç≤Âãù‰∫ÜÔºÅ');
                    return true;
                }

                // Ê™¢Êü•Âπ≥Â±Ä
                if (isBoardFull()) {
                    gameOver = true;
                    showWinner('Âπ≥Â±ÄÔºÅ');
                    return true;
                }

                // ÂàáÊèõÂà∞AI
                currentPlayer = 'white';
                updateStatus('AIÊÄùËÄÉ‰∏≠...');
                document.getElementById('undoBtn').disabled = false;

                // AIÂª∂ÈÅ≤‰∏ãÊ£ãÔºåÂ¢ûÂä†ÁúüÂØ¶ÊÑü
                setTimeout(() => {
                    if (!gameOver) {
                        aiMove();
                    }
                }, 800);

                return true;
            }

            // AI‰∏ãÊ£ã
            function aiMove() {
                const difficulty = document.getElementById('difficultySelect').value;
                let bestMove;

                switch (difficulty) {
                    case 'easy':
                        bestMove = getRandomMove();
                        break;
                    case 'medium':
                        bestMove = getMediumMove();
                        break;
                    case 'hard':
                        bestMove = getHardMove();
                        break;
                }

                if (bestMove) {
                    const { row, col } = bestMove;
                    moveHistory.push({ row, col, player: currentPlayer });
                    board[row][col] = currentPlayer;
                    updateBoard();

                    // Ê™¢Êü•AIÊòØÂê¶Áç≤Âãù
                    if (checkWin(row, col, currentPlayer)) {
                        gameOver = true;
                        showWinner('AIÁç≤ÂãùÔºÅÂÜçË©¶‰∏ÄÊ¨°ÂêßÔºÅ');
                        return;
                    }

                    // Ê™¢Êü•Âπ≥Â±Ä
                    if (isBoardFull()) {
                        gameOver = true;
                        showWinner('Âπ≥Â±ÄÔºÅ');
                        return;
                    }

                    // ÂàáÊèõÂõûÁé©ÂÆ∂
                    currentPlayer = 'black';
                    updateStatus('Ëº™Âà∞ÊÇ®‰∏ãÊ£ã (ÈªëÂ≠ê)');
                }
            }

            // Á∞°ÂñÆAI - Èö®Ê©ü‰∏ãÊ£ã
            function getRandomMove() {
                const emptyCells = [];
                for (let i = 0; i < BOARD_SIZE; i++) {
                    for (let j = 0; j < BOARD_SIZE; j++) {
                        if (!board[i][j]) {
                            emptyCells.push({ row: i, col: j });
                        }
                    }
                }
                return emptyCells.length > 0 ? emptyCells[Math.floor(Math.random() * emptyCells.length)] : null;
            }

            // ‰∏≠Á≠âAI - Âü∫Á§éÁ≠ñÁï•
            function getMediumMove() {
                // 1. Ê™¢Êü•AIÊòØÂê¶ËÉΩÁç≤Âãù
                for (let i = 0; i < BOARD_SIZE; i++) {
                    for (let j = 0; j < BOARD_SIZE; j++) {
                        if (!board[i][j]) {
                            board[i][j] = 'white';
                            if (checkWin(i, j, 'white')) {
                                board[i][j] = null;
                                return { row: i, col: j };
                            }
                            board[i][j] = null;
                        }
                    }
                }

                // 2. ÈòªÊ≠¢Áé©ÂÆ∂Áç≤Âãù
                for (let i = 0; i < BOARD_SIZE; i++) {
                    for (let j = 0; j < BOARD_SIZE; j++) {
                        if (!board[i][j]) {
                            board[i][j] = 'black';
                            if (checkWin(i, j, 'black')) {
                                board[i][j] = null;
                                return { row: i, col: j };
                            }
                            board[i][j] = null;
                        }
                    }
                }

                // 3. Âê¶ÂâáÈö®Ê©üÈÅ∏Êìá
                return getRandomMove();
            }

            // Âõ∞Èõ£AI - Êõ¥È´òÁ¥öÁ≠ñÁï•
            function getHardMove() {
                let bestScore = -Infinity;
                let bestMove = null;

                // Ë©ï‰º∞ÊØèÂÄãÂèØËÉΩÁöÑ‰ΩçÁΩÆ
                for (let i = 0; i < BOARD_SIZE; i++) {
                    for (let j = 0; j < BOARD_SIZE; j++) {
                        if (!board[i][j]) {
                            const score = evaluatePosition(i, j, 'white');
                            if (score > bestScore) {
                                bestScore = score;
                                bestMove = { row: i, col: j };
                            }
                        }
                    }
                }

                return bestMove || getRandomMove();
            }

            // Ë©ï‰º∞‰ΩçÁΩÆÂæóÂàÜ
            function evaluatePosition(row, col, player) {
                let score = 0;
                const directions = [
                    [0, 1], [1, 0], [1, 1], [1, -1] // Ê∞¥Âπ≥„ÄÅÂûÇÁõ¥„ÄÅÂ∞çËßíÁ∑ö
                ];

                for (const [dx, dy] of directions) {
                    const count = countInDirection(row, col, dx, dy, player) +
                        countInDirection(row, col, -dx, -dy, player) + 1;

                    // Ê†πÊìöÈÄ£Á∫åÊ£ãÂ≠êÊï∏ÈáèÁµ¶ÂàÜ
                    if (count >= 5) score += 10000;
                    else if (count === 4) score += 1000;
                    else if (count === 3) score += 100;
                    else if (count === 2) score += 10;
                    else score += 1;
                }

                // Â¶ÇÊûúËÉΩÈòªÊ≠¢Â∞çÊâãÁç≤ÂãùÔºåÂä†ÂàÜ
                const opponentPlayer = player === 'white' ? 'black' : 'white';
                for (const [dx, dy] of directions) {
                    const opponentCount = countInDirection(row, col, dx, dy, opponentPlayer) +
                        countInDirection(row, col, -dx, -dy, opponentPlayer) + 1;
                    if (opponentCount >= 4) score += 5000;
                }

                return score;
            }

            // Ë®àÁÆóÁâπÂÆöÊñπÂêëÁöÑÈÄ£Á∫åÊ£ãÂ≠êÊï∏
            function countInDirection(row, col, dx, dy, player) {
                let count = 0;
                let newRow = row + dx;
                let newCol = col + dy;

                while (newRow >= 0 && newRow < BOARD_SIZE &&
                    newCol >= 0 && newCol < BOARD_SIZE &&
                    board[newRow][newCol] === player) {
                    count++;
                    newRow += dx;
                    newCol += dy;
                }

                return count;
            }

            // Êõ¥Êñ∞Ê£ãÁõ§È°ØÁ§∫
            function updateBoard() {
                const cells = document.querySelectorAll('.cell');
                cells.forEach((cell, index) => {
                    const row = Math.floor(index / BOARD_SIZE);
                    const col = index % BOARD_SIZE;
                    const piece = board[row][col];

                    cell.className = 'cell';
                    if (piece) {
                        cell.classList.add(piece);
                    }
                });
            }

            // Ê™¢Êü•ÂãùÂà©Ê¢ù‰ª∂
            function checkWin(row, col, player) {
                const directions = [
                    [0, 1], [1, 0], [1, 1], [1, -1]
                ];

                for (const [dx, dy] of directions) {
                    let count = 1;

                    // Ê≠£ÊñπÂêëË®àÊï∏
                    let newRow = row + dx;
                    let newCol = col + dy;
                    while (newRow >= 0 && newRow < BOARD_SIZE &&
                        newCol >= 0 && newCol < BOARD_SIZE &&
                        board[newRow][newCol] === player) {
                        count++;
                        newRow += dx;
                        newCol += dy;
                    }

                    // ÂèçÊñπÂêëË®àÊï∏
                    newRow = row - dx;
                    newCol = col - dy;
                    while (newRow >= 0 && newRow < BOARD_SIZE &&
                        newCol >= 0 && newCol < BOARD_SIZE &&
                        board[newRow][newCol] === player) {
                        count++;
                        newRow -= dx;
                        newCol -= dy;
                    }

                    if (count >= 5) {
                        return true;
                    }
                }
                return false;
            }

            // Ê™¢Êü•Ê£ãÁõ§ÊòØÂê¶Â∑≤Êªø
            function isBoardFull() {
                for (let i = 0; i < BOARD_SIZE; i++) {
                    for (let j = 0; j < BOARD_SIZE; j++) {
                        if (!board[i][j]) {
                            return false;
                        }
                    }
                }
                return true;
            }

            // È°ØÁ§∫Áç≤ÂãùËÄÖ
            function showWinner(message) {
                document.getElementById('winner').textContent = message;
                document.getElementById('winner').style.display = 'block';
                updateStatus('ÈÅäÊà≤ÁµêÊùü');
            }

            // ÈáçÊñ∞ÈñãÂßãÈÅäÊà≤
            function startNewGame() {
                initGame();
            }

            // ÊÇîÊ£ãÂäüËÉΩ
            function undoMove() {
                if (moveHistory.length >= 2 && !gameOver) {
                    // Êí§Èä∑AIÁöÑÁßªÂãï
                    const aiMove = moveHistory.pop();
                    board[aiMove.row][aiMove.col] = null;

                    // Êí§Èä∑Áé©ÂÆ∂ÁöÑÁßªÂãï
                    const playerMove = moveHistory.pop();
                    board[playerMove.row][playerMove.col] = null;

                    currentPlayer = 'black';
                    updateBoard();
                    updateStatus('Ëº™Âà∞ÊÇ®‰∏ãÊ£ã (ÈªëÂ≠ê)');

                    if (moveHistory.length === 0) {
                        document.getElementById('undoBtn').disabled = true;
                    }
                }
            }

            // ÂàùÂßãÂåñÈÅäÊà≤
            initGame();
        </script>
    </body>

</html>